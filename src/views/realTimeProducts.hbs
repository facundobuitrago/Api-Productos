<section>
  <h1 style="text-align:center; font-size:32px; margin-bottom:30px;">
    Productos en Tiempo Real
  </h1>

  <!-- GRID -->
  <ul id="products-list" style="
    list-style:none; padding:0;
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
    gap:20px;
    max-width:1200px;
    margin:auto;">
    
    {{#each products}}
    <li class="product" data-product-id="{{_id}}" style="
      background: var(--bg-card,#111827);
      border-radius:18px;
      padding:20px;
      box-shadow:0 14px 35px rgba(0,0,0,.45);
      border:1px solid #1f2937;">
      
      <h2 style="margin:0 0 6px; font-size:19px; font-weight:600;">
        {{nombre}}
      </h2>

      <p style="margin:0; color:var(--text-muted); font-size:13px;">
        {{descripcion}}
      </p>

      <p style="margin:12px 0 2px; font-size:14px;">
        <strong>Precio:</strong> ${{precio}}
      </p>

      <p style="margin:2px 0 16px; font-size:14px;">
        <strong>Stock:</strong> {{stock}}
      </p>

      <!-- AGREGAR AL CARRITO POR POST -->
      <form action="/add-to-cart" method="POST" style="display:inline;">
        <input type="hidden" name="productId" value="{{_id}}">
        <button class="btn btn-primary" type="submit">
          Agregar
        </button>
      </form>

      <!-- ELIMINAR -->
      <button
        class="btn btn-ghost delete-btn"
        style="margin-left:10px;"
        data-product-id="{{_id}}">
        Eliminar
      </button>

    </li>
    {{/each}}

  </ul>

  <div style="text-align:center; margin-top:30px;">
    <a href="/">
      <button class="btn btn-primary">Volver al Home</button>
    </a>
  </div>
</section>

<script>
  const socket = io();

  // ðŸ—‘ ELIMINAR PRODUCTO
  document.addEventListener("click", (event) => {
    if (event.target.classList.contains("delete-btn")) {
      const id = event.target.dataset.productId;
      socket.emit("delete-product", id);
    }
  });

  // ðŸ”¥ AGREGAR PRODUCTO EN TIEMPO REAL (ya lo tenÃ©s en server.js)
  socket.on("productos-actuales", (productos) => {
    const list = document.getElementById("products-list");
    list.innerHTML = "";

    productos.forEach((p) => {
      const li = document.createElement("li");
      li.className = "product";
      li.dataset.productId = p._id;
      li.style.background = "#111827";
      li.style.borderRadius = "18px";
      li.style.padding = "20px";
      li.style.boxShadow = "0 14px 35px rgba(0,0,0,.45)";
      li.style.border = "1px solid #1f2937";

      li.innerHTML = `
        <h2 style="margin:0 0 6px;font-size:19px;font-weight:600;">${p.nombre}</h2>
        <p style="margin:0;color:#9ca3af;font-size:13px;">${p.descripcion}</p>

        <p style="margin:12px 0 2px;font-size:14px;"><strong>Precio:</strong> $${p.precio}</p>
        <p style="margin:2px 0 16px;font-size:14px;"><strong>Stock:</strong> ${p.stock}</p>

        <form action="/add-to-cart" method="POST" style="display:inline;">
          <input type="hidden" name="productId" value="${p._id}">
          <button class="btn btn-primary" type="submit">Agregar</button>
        </form>

        <button
          class="btn btn-ghost delete-btn"
          data-product-id="${p._id}"
          style="margin-left:10px;">
          Eliminar
        </button>
      `;

      list.appendChild(li);
    });
  });
</script>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

// ðŸ”¥ cuando el backend actualiza stock
socket.on("stock-actualizado", ({ productId, newStock }) => {
    const item = document.querySelector(`[data-product-id="${productId}"]`);
    if (item) {
        const stockTag = item.querySelector(".stock");
        if (stockTag) stockTag.textContent = "Stock: " + newStock;
    }
});
</script>

